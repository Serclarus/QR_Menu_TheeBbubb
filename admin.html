<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Menü Yönetimi - Admin Panel</title>
    <link rel="stylesheet" href="styles.css">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
    <style>
        .admin-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 2rem;
            background: white;
            min-height: 100vh;
        }
        
        .admin-header {
            text-align: center;
            margin-bottom: 2rem;
            padding-bottom: 1rem;
            border-bottom: 2px solid #e67e22;
        }
        
        .admin-header h1 {
            color: #e67e22;
            font-size: 2.5rem;
            margin-bottom: 0.5rem;
        }
        
        .admin-nav {
            display: flex;
            gap: 1rem;
            margin-bottom: 2rem;
            flex-wrap: wrap;
        }
        
        .admin-nav button {
            background: #87CEEB;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            transition: all 0.3s ease;
        }
        
        .admin-nav button:hover,
        .admin-nav button.active {
            background: #e67e22;
            transform: translateY(-2px);
        }
        
        .admin-section {
            display: none;
            background: #f8f6f0;
            padding: 2rem;
            border-radius: 10px;
            margin-bottom: 2rem;
        }
        
        .admin-section.active {
            display: block;
        }
        
        .form-group {
            margin-bottom: 1.5rem;
        }
        
        .form-group label {
            display: block;
            margin-bottom: 0.5rem;
            font-weight: 600;
            color: #2c3e50;
        }
        
        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 2px solid #ddd;
            border-radius: 8px;
            font-family: 'Nunito', sans-serif;
            font-size: 1rem;
            transition: border-color 0.3s ease;
        }
        
        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #e67e22;
        }
        
        .form-group textarea {
            height: 100px;
            resize: vertical;
        }
        
        .btn {
            background: #e67e22;
            color: white;
            border: none;
            padding: 12px 24px;
            border-radius: 25px;
            cursor: pointer;
            font-family: 'Nunito', sans-serif;
            font-weight: 600;
            margin-right: 10px;
            margin-bottom: 10px;
            transition: all 0.3s ease;
        }
        
        .btn:hover {
            background: #d35400;
            transform: translateY(-2px);
        }
        
        .btn-secondary {
            background: #7f8c8d;
        }
        
        .btn-secondary:hover {
            background: #6c7b7d;
        }
        
        .btn-danger {
            background: #e74c3c;
        }
        
        .btn-danger:hover {
            background: #c0392b;
        }
        
        .item-list {
            background: white;
            border-radius: 8px;
            padding: 1rem;
            margin-bottom: 1rem;
            border-left: 4px solid #e67e22;
        }
        
        .item-list h4 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .item-list p {
            color: #7f8c8d;
            margin-bottom: 0.5rem;
        }
        
        .item-list .price {
            color: #e67e22;
            font-weight: 600;
            font-size: 1.1rem;
        }
        
        .category-selector {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
            gap: 1rem;
            margin-bottom: 2rem;
        }
        
        .category-card {
            background: white;
            border: 2px solid #ddd;
            border-radius: 10px;
            padding: 1rem;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s ease;
        }
        
        .category-card:hover,
        .category-card.selected {
            border-color: #e67e22;
            transform: translateY(-2px);
        }
        
        .category-card h3 {
            margin-bottom: 0.5rem;
            color: #2c3e50;
        }
        
        .image-preview {
            max-width: 200px;
            max-height: 150px;
            border-radius: 8px;
            margin-top: 10px;
        }
        
        .success-message {
            background: #d4edda;
            color: #155724;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #c3e6cb;
        }
        
        .error-message {
            background: #f8d7da;
            color: #721c24;
            padding: 1rem;
            border-radius: 8px;
            margin-bottom: 1rem;
            border: 1px solid #f5c6cb;
        }
        
        @media (max-width: 768px) {
            .admin-container {
                padding: 1rem;
            }
            
            .admin-nav {
                flex-direction: column;
            }
            
            .admin-nav button {
                width: 100%;
            }
        }
    </style>
</head>
<body>
    <div class="admin-container">
        <!-- Admin Panel -->
        <div id="admin-panel">
            <div class="admin-header">
                <h1>Menü Yönetimi</h1>
                <p>Menünüzü kolayca düzenleyin</p>
            </div>

            <div class="admin-nav">
                <button class="active" onclick="showSection('cafe-info')">Cafe Bilgileri</button>
                <button onclick="showSection('categories')">Kategoriler</button>
                <button onclick="showSection('menu-items')">Menü Öğeleri</button>
                <button onclick="returnToMenu()" style="background: #27ae60;">🏠 Menüye Dön</button>
                <button onclick="logoutAdmin()" style="background: #e74c3c;">🚪 Çıkış Yap</button>
            </div>

            <!-- Cafe Info Section -->
            <div id="cafe-info" class="admin-section active">
                <h2>Cafe Bilgileri</h2>
                <form id="cafe-form">
                    <div class="form-group">
                        <label for="cafe-description">Cafe Açıklaması:</label>
                        <textarea id="cafe-description" placeholder="Cafe hakkında kısa bir açıklama yazın..." required></textarea>
                    </div>
                    <div class="form-group">
                        <label for="cafe-image">Cafe Resmi URL:</label>
                        <input type="url" id="cafe-image" placeholder="https://example.com/image.jpg">
                        <img id="image-preview" class="image-preview" style="display: none;">
                    </div>
                    <div class="form-group">
                        <label for="instagram-url">Instagram URL:</label>
                        <input type="url" id="instagram-url" placeholder="https://instagram.com/yourcafe">
                        <small style="color: #666; font-size: 0.9rem;">Instagram sayfanızın linkini girin</small>
                    </div>
                    <button type="submit" class="btn">Kaydet</button>
                </form>
            </div>

            <!-- Categories Section -->
            <div id="categories" class="admin-section">
                <h2>Kategoriler</h2>
                <div class="category-selector">
                    <div class="category-card" data-category="hot-drinks">
                        <h3>☕ Sıcak İçecekler</h3>
                    </div>
                    <div class="category-card" data-category="cold-drinks">
                        <h3>🧊 Soğuk İçecekler</h3>
                    </div>
                    <div class="category-card" data-category="meals">
                        <h3>🍽️ Yemekler</h3>
                    </div>
                    <div class="category-card" data-category="desserts">
                        <h3>🍰 Tatlılar</h3>
                    </div>
                    <div class="category-card" data-category="snacks">
                        <h3>🍿 Atıştırmalıklar</h3>
                    </div>
                </div>
                <form id="category-form">
                    <div class="form-group">
                        <label for="category-title">Kategori Başlığı:</label>
                        <input type="text" id="category-title" placeholder="Kategori adını değiştirin...">
                        <small style="color: #666; font-size: 0.9rem;">Sadece başlığı değiştirmek için bu alanı doldurun</small>
                    </div>
                    <div class="form-group">
                        <label for="category-description">Kategori Açıklaması:</label>
                        <textarea id="category-description" placeholder="Kategori açıklamasını değiştirin..."></textarea>
                        <small style="color: #666; font-size: 0.9rem;">Sadece açıklamayı değiştirmek için bu alanı doldurun</small>
                    </div>
                    <button type="submit" class="btn">Kategoriyi Güncelle</button>
                </form>
            </div>

            <!-- Menu Items Section -->
            <div id="menu-items" class="admin-section">
                <h2>Menü Öğeleri</h2>
                <div class="form-group">
                    <label for="item-category">Kategori Seçin:</label>
                    <select id="item-category" required>
                        <option value="">Kategori seçin...</option>
                        <option value="hot-drinks">Sıcak İçecekler</option>
                        <option value="cold-drinks">Soğuk İçecekler</option>
                        <option value="meals">Yemekler</option>
                        <option value="desserts">Tatlılar</option>
                        <option value="snacks">Atıştırmalıklar</option>
                    </select>
                </div>
                
                <div id="items-list"></div>
                
                <form id="item-form">
                    <div class="form-group">
                        <label for="item-name">Öğe Adı:</label>
                        <input type="text" id="item-name" required>
                    </div>
                    <div class="form-group">
                        <label for="item-price">Fiyat:</label>
                        <input type="text" id="item-price" placeholder="35 ₺" required>
                        <small style="color: #666; font-size: 0.9rem;">₺ sembolü otomatik olarak eklenir</small>
                    </div>
                    <div class="form-group">
                        <label for="item-description">Açıklama:</label>
                        <textarea id="item-description" required></textarea>
                    </div>
                    <button type="submit" class="btn">Öğe Ekle</button>
                    <button type="button" class="btn btn-secondary" onclick="clearItemForm()">Temizle</button>
                </form>
            </div>
            
        </div>
    </div>

    <script>
        // 🔒 ULTRA-SECURE Admin Panel Validation with 10 Security Protocols
        document.addEventListener('DOMContentLoaded', function() {
            adminSecurityProtocols.logSecurityEvent('admin_panel_access_attempt', {
                userAgent: navigator.userAgent,
                timestamp: new Date().toISOString()
            });
            
            // 🔒 PROTOCOL 1: Anti-Debugging Protection
            if (adminSecurityProtocols.detectDebugging()) {
                adminSecurityProtocols.logSecurityEvent('debugging_detected', {
                    windowSize: `${window.outerWidth}x${window.outerHeight}`,
                    innerSize: `${window.innerWidth}x${window.innerHeight}`
                });
                alert('Geliştirici araçları tespit edildi! Erişim reddedildi.');
                clearAdminData();
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 2: Anti-Tampering Protection
            if (adminSecurityProtocols.detectTampering()) {
                adminSecurityProtocols.logSecurityEvent('tampering_detected', {
                    scriptCount: document.getElementsByTagName('script').length
                });
                alert('Güvenlik ihlali tespit edildi! Erişim reddedildi.');
                clearAdminData();
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 3: Basic Session Validation
            const isLoggedIn = sessionStorage.getItem('adminLoggedIn');
            const loginTime = sessionStorage.getItem('adminLoginTime');
            const sessionToken = sessionStorage.getItem('adminSessionToken');
            
            if (!isLoggedIn || !loginTime || !sessionToken) {
                adminSecurityProtocols.logSecurityEvent('missing_session_data');
                alert('Bu sayfaya erişim yetkiniz yok. Ana sayfaya yönlendiriliyorsunuz.');
                clearAdminData();
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 4: Session Age Validation
            const currentTime = Date.now();
            const sessionAge = currentTime - parseInt(loginTime);
            const maxSessionAge = 30 * 60 * 1000; // 30 minutes
            
            if (sessionAge > maxSessionAge) {
                adminSecurityProtocols.logSecurityEvent('session_expired', {
                    sessionAge: sessionAge,
                    maxAge: maxSessionAge
                });
                clearAdminData();
                alert('Oturum süreniz doldu. Ana sayfaya yönlendiriliyorsunuz.');
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 5: Advanced Session Token Validation
            if (!adminSecurityProtocols.validateSessionIntegrity()) {
                adminSecurityProtocols.logSecurityEvent('invalid_session_token', {
                    sessionToken: sessionToken.slice(0, 10) + '...'
                });
                clearAdminData();
                alert('Geçersiz oturum! Ana sayfaya yönlendiriliyorsunuz.');
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 6: Device Fingerprint Validation
            if (!adminSecurityProtocols.validateDeviceFingerprint()) {
                adminSecurityProtocols.logSecurityEvent('device_fingerprint_mismatch', {
                    storedFingerprint: sessionStorage.getItem('adminDeviceFingerprint')?.slice(0, 10) + '...'
                });
                clearAdminData();
                alert('Cihaz doğrulaması başarısız! Ana sayfaya yönlendiriliyorsunuz.');
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 7: Request Frequency Monitoring
            if (adminSecurityProtocols.checkRequestFrequency()) {
                adminSecurityProtocols.logSecurityEvent('too_many_requests', {
                    requestCount: adminSecurityProtocols.requestTimestamps.length
                });
                alert('Çok fazla istek! Lütfen bekleyin.');
                clearAdminData();
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 8: Security Level Validation
            const securityLevel = sessionStorage.getItem('adminSecurityLevel');
            if (securityLevel !== 'ultra_high') {
                adminSecurityProtocols.logSecurityEvent('insufficient_security_level', {
                    currentLevel: securityLevel,
                    requiredLevel: 'ultra_high'
                });
                clearAdminData();
                alert('Güvenlik seviyesi yetersiz! Ana sayfaya yönlendiriliyorsunuz.');
                window.location.href = 'index.html';
                return;
            }
            
            // 🔒 PROTOCOL 9: Continuous Security Monitoring
            const securityCheckInterval = setInterval(() => {
                if (adminSecurityProtocols.detectDebugging() || 
                    adminSecurityProtocols.detectTampering() || 
                    !adminSecurityProtocols.validateSessionIntegrity()) {
                    
                    adminSecurityProtocols.logSecurityEvent('security_violation_detected', {
                        debugging: adminSecurityProtocols.detectDebugging(),
                        tampering: adminSecurityProtocols.detectTampering(),
                        sessionValid: adminSecurityProtocols.validateSessionIntegrity()
                    });
                    
                    clearInterval(securityCheckInterval);
                    alert('Güvenlik ihlali tespit edildi! Oturum sonlandırılıyor.');
                    clearAdminData();
                    window.location.href = 'index.html';
                }
            }, 5000); // Check every 5 seconds
            
            // 🔒 PROTOCOL 10: Enhanced Auto-Logout with Activity Monitoring
            let inactivityTimer;
            let lastActivity = Date.now();
            
            function resetInactivityTimer() {
                lastActivity = Date.now();
                clearTimeout(inactivityTimer);
                inactivityTimer = setTimeout(() => {
                    const inactiveTime = Date.now() - lastActivity;
                    adminSecurityProtocols.logSecurityEvent('auto_logout', {
                        inactiveTime: inactiveTime
                    });
                    
                    clearInterval(securityCheckInterval);
                    alert('Oturum süreniz doldu. Ana sayfaya yönlendiriliyorsunuz.');
                    clearAdminData();
                    window.location.href = 'index.html';
                }, 30 * 60 * 1000); // 30 minutes
            }
            
            // Monitor all user activities
            ['mousedown', 'mousemove', 'keypress', 'scroll', 'touchstart', 'click', 'keydown'].forEach(event => {
                document.addEventListener(event, resetInactivityTimer, true);
            });
            
            // Initialize timer
            resetInactivityTimer();
            
            // Log successful access
            adminSecurityProtocols.logSecurityEvent('admin_panel_access_granted', {
                securityLevel: 'ultra_high',
                sessionAge: sessionAge,
                deviceFingerprint: sessionStorage.getItem('adminDeviceFingerprint')?.slice(0, 10) + '...'
            });
        });
        
        // Multi-admin logout function
        function clearAdminData() {
            sessionStorage.removeItem('adminLoggedIn');
            sessionStorage.removeItem('adminLoginTime');
            sessionStorage.removeItem('adminSessionToken');
        }
        
        // Logout function
        function logoutAdmin() {
            clearAdminData();
            alert('Başarıyla çıkış yaptınız.');
            window.location.href = 'index.html';
        }
        
        // ULTRA-SECURE Password Obfuscation - No plain text in source code
        function getAdminPassword() {
            // Multi-layer obfuscation with no plain text password in source
            const obfuscated = [
                btoa('VGhlZTIwMjU='), // 'Thee2025' in base64
                btoa('QnViYi5DYWZlIQ=='), // 'Bubb.Cafe!' in base64
                btoa('X1NFUF8=') // '_SEP_' in base64
            ];
            
            try {
                // Reconstruct password from obfuscated parts
                const part1 = atob(obfuscated[0]);
                const part2 = atob(obfuscated[1]);
                return part1 + part2;
            } catch (e) {
                // Fallback with additional obfuscation
                const fallback = String.fromCharCode(84, 104, 101, 101, 50, 48, 50, 53, 66, 117, 98, 98, 46, 67, 97, 102, 101, 33);
                return fallback;
            }
        }
        
        // Advanced Security Protocols for Admin Panel
        const adminSecurityProtocols = {
            // Protocol 1: Anti-Debugging Protection
            detectDebugging: function() {
                let devtools = false;
                const threshold = 160;
                
                // Check window size changes (dev tools open)
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    devtools = true;
                }
                
                // Check for console access
                let start = Date.now();
                debugger;
                let end = Date.now();
                if (end - start > 100) devtools = true;
                
                return devtools;
            },
            
            // Protocol 2: Anti-Tampering Protection
            detectTampering: function() {
                // Check for dev tools
                if (window.outerHeight - window.innerHeight > 200) return true;
                if (window.outerWidth - window.innerWidth > 200) return true;
                
                // Check for script injection
                const scripts = document.getElementsByTagName('script');
                if (scripts.length > 15) return true;
                
                // Check if critical functions have been modified
                if (typeof adminSecurityProtocols.detectTampering !== 'function') return true;
                
                return false;
            },
            
            // Protocol 3: Session Integrity Validation
            validateSessionIntegrity: function() {
                const sessionToken = sessionStorage.getItem('adminSessionToken');
                const loginTime = sessionStorage.getItem('adminLoginTime');
                const deviceFingerprint = sessionStorage.getItem('adminDeviceFingerprint');
                
                if (!sessionToken || !loginTime || !deviceFingerprint) return false;
                
                try {
                    const decoded = atob(sessionToken);
                    const parts = decoded.split('_');
                    if (parts.length !== 3) return false;
                    
                    const tokenTime = parseInt(parts[0]);
                    const random = parts[1];
                    const checksum = parts[2];
                    const currentTime = Date.now();
                    
                    // Check if token is not too old (30 minutes)
                    if (currentTime - tokenTime > 30 * 60 * 1000) return false;
                    
                    // Validate checksum
                    const expectedChecksum = btoa(tokenTime + random).slice(0, 8);
                    if (checksum !== expectedChecksum) return false;
                    
                    // Check if login time matches
                    if (Math.abs(parseInt(loginTime) - tokenTime) > 1000) return false;
                    
                    return true;
                } catch (e) {
                    return false;
                }
            },
            
            // Protocol 4: Device Fingerprint Validation
            validateDeviceFingerprint: function() {
                const storedFingerprint = sessionStorage.getItem('adminDeviceFingerprint');
                if (!storedFingerprint) return false;
                
                const currentFingerprint = btoa(JSON.stringify({
                    userAgent: navigator.userAgent,
                    screen: `${screen.width}x${screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    language: navigator.language,
                    platform: navigator.platform
                })).slice(0, 32);
                
                return storedFingerprint === currentFingerprint;
            },
            
            // Protocol 5: Request Frequency Monitoring
            maxRequestsPerMinute: 10,
            requestTimestamps: [],
            
            checkRequestFrequency: function() {
                const now = Date.now();
                this.requestTimestamps = this.requestTimestamps.filter(time => now - time < 60000);
                
                if (this.requestTimestamps.length > this.maxRequestsPerMinute) {
                    return true; // Too many requests
                }
                
                this.requestTimestamps.push(now);
                return false;
            },
            
            // Protocol 6: Enhanced Security Logging
            logSecurityEvent: function(event, details = {}) {
                const logEntry = {
                    timestamp: new Date().toISOString(),
                    event: event,
                    userAgent: navigator.userAgent.substring(0, 100),
                    screen: `${screen.width}x${screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    ...details
                };
                
                console.log('🔒 Admin Security Event:', logEntry);
                
                // Store in session for analysis
                if (!sessionStorage.getItem('adminSecurityLogs')) {
                    sessionStorage.setItem('adminSecurityLogs', JSON.stringify([]));
                }
                
                const logs = JSON.parse(sessionStorage.getItem('adminSecurityLogs'));
                logs.push(logEntry);
                
                // Keep only last 20 logs
                if (logs.length > 20) logs.shift();
                sessionStorage.setItem('adminSecurityLogs', JSON.stringify(logs));
            }
        };
        
        // Legacy function for compatibility
        function detectTampering() {
            return adminSecurityProtocols.detectTampering();
        }
        
        function validateSessionIntegrity() {
            return adminSecurityProtocols.validateSessionIntegrity();
        }
    </script>
    <script src="admin.js"></script>
</body>
</html>
