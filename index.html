<!DOCTYPE html>
    <html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kafe Men√ºs√º - QR Kod Tarayƒ±n</title>
    <link rel="stylesheet" href="styles.css?v=74">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header with Cafe Image -->
        <header class="header">
            <div class="cafe-image">
                <img src="https://images.unsplash.com/photo-1554118811-1e0d58224f24?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80" alt="Cafe Interior" />
                <div class="cafe-overlay">
                    <h1 class="cafe-name">THEE BBUBB CAFE</h1>
                    <p class="cafe-description">Lezzetli kahve ve taze yemekler i√ßin bizi tercih edin</p>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="main-nav">
            <h2>Men√ºm√ºz</h2>
            <div class="category-grid">
                <div class="category-card" data-category="Sƒ±cak ƒ∞√ßecekler">
                    <div class="category-icon">
                        <img src="hotdrinks_icon.png" alt="Sƒ±cak ƒ∞√ßecekler" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Sƒ±cak ƒ∞√ßecekler</h3>
                </div>
                <div class="category-card" data-category="Soƒüuk ƒ∞√ßecekler">
                    <div class="category-icon">
                        <img src="colddrinks_icon.png" alt="Soƒüuk ƒ∞√ßecekler" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Soƒüuk ƒ∞√ßecekler</h3>
                </div>
                <div class="category-card" data-category="Ana Yemekler">
                    <div class="category-icon">
                        <img src="foods_icon.png" alt="Ana Yemekler" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Ana Yemekler</h3>
                </div>
                <div class="category-card" data-category="Tatlƒ±lar">
                    <div class="category-icon">
                        <img src="desserts_icon.png" alt="Tatlƒ±lar" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Tatlƒ±lar</h3>
                </div>
                <div class="category-card" data-category="Atƒ±≈ütƒ±rmalƒ±klar">
                    <div class="category-icon">
                        <img src="snacks_icon.png" alt="Atƒ±≈ütƒ±rmalƒ±klar" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Atƒ±≈ütƒ±rmalƒ±klar</h3>
                </div>
                <div class="category-card" data-category="Nargile">
                    <div class="category-icon">
                        <img src="hookah-icon.png" alt="Nargile" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Nargile</h3>
                </div>
            </div>
        </nav>
        
        <!-- Instagram Button -->
        <div class="instagram-section">
            <a href="https://www.instagram.com/theebbubb/" id="instagram-link" class="instagram-btn" target="_blank" rel="noopener noreferrer">
                <img src="instagram_icon.png" alt="Instagram" class="instagram-logo">
            </a>
        </div>

        <!-- Category Content -->
        <main class="category-content" id="category-content">
            <!-- Content will be dynamically loaded here -->
        </main>

        <!-- Back Button -->
        <button class="back-btn" id="back-btn" style="display: none;">
            ‚Üê Men√ºye D√∂n
        </button>
        
        <!-- Secure Admin Access - Hidden and protected -->
    </div>

    <script src="script.js"></script>
    <script>
        // Instagram button handler - simple and reliable
        document.addEventListener('DOMContentLoaded', function() {
            const instagramLink = document.getElementById('instagram-link');
            if (instagramLink) {
                instagramLink.addEventListener('click', function(e) {
                    // Allow the default behavior to work (direct link)
                    // This ensures the link works properly
                    console.log('Instagram button clicked');
                });
            }
        });

        // Clean Back Button System - From Scratch
        let exitAttempts = 0;
        let exitMessageShown = false;
        let isProcessingBack = false;
        let lastBackPress = 0;
        let isOnMainPageState = true; // Track current page state
        
        // Check if we're on main page or in a category
        function isOnMainPage() {
            const categoryContent = document.getElementById('category-content');
            const mainNav = document.querySelector('.main-nav');
            
            // Simple check: if category content is not visible, we're on main page
            const isCategoryVisible = categoryContent && categoryContent.style.display === 'block';
            const isMain = !isCategoryVisible;
            
            console.log('isOnMainPage check:', { 
                categoryContent, 
                categoryDisplay: categoryContent?.style.display, 
                isCategoryVisible,
                isMain 
            });
            return isMain;
        }
        
        // Handle back button press
        function handleBackPress() {
            const now = Date.now();
            
            // Prevent multiple rapid triggers
            if (isProcessingBack || (now - lastBackPress) < 500) {
                console.log('Back button ignored - too soon or already processing');
                return;
            }
            
            isProcessingBack = true;
            lastBackPress = now;
            
            console.log('Back button pressed, isOnMainPageState:', isOnMainPageState);
            
            // Check current page state dynamically
            const categoryContent = document.getElementById('category-content');
            const isCurrentlyInCategory = categoryContent && categoryContent.style.display === 'block';
            
            if (isCurrentlyInCategory) {
                // In category - go to main page
                console.log('In category - going to main page');
                goToMainPage();
            } else {
                // On main page - show exit confirmation
                console.log('On main page - showing exit confirmation');
                handleExitAttempt();
            }
            
            // Reset processing flag after a delay
            setTimeout(() => {
                isProcessingBack = false;
            }, 1000);
        }
        
        // Go to main page (direct navigation)
        function goToMainPage() {
            console.log('goToMainPage called');
            const mainNav = document.querySelector('.main-nav');
            const backBtn = document.getElementById('back-btn');
            const categoryContent = document.getElementById('category-content');
            const instagramSection = document.querySelector('.instagram-section');
            
            console.log('Elements found:', { mainNav, backBtn, categoryContent, instagramSection });
            
            // Show main navigation
            if (mainNav) {
                mainNav.style.display = 'block';
                console.log('Main nav shown');
            }
            
            // Hide back button
            if (backBtn) {
                backBtn.style.display = 'none';
                console.log('Back button hidden');
            }
            
            // Hide category content
            if (categoryContent) {
                categoryContent.style.display = 'none';
                categoryContent.innerHTML = '';
                console.log('Category content hidden');
            }
            
            // Show Instagram button
            if (instagramSection) {
                instagramSection.classList.remove('hidden');
                console.log('Instagram section shown');
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Reset exit attempts when going to main page
            resetExitAttempts();
            
            // Update state to main page
            isOnMainPageState = true;
            console.log('goToMainPage completed, isOnMainPageState set to true');
        }
        
        // Handle exit attempts
        function handleExitAttempt() {
            console.log('Exit attempt #' + (exitAttempts + 1));
            exitAttempts++;
            
            if (exitAttempts === 1) {
                // First attempt - show message
                console.log('Showing exit message');
                showExitMessage();
            } else if (exitAttempts >= 2) {
                // Second attempt - actually exit
                console.log('Second exit attempt - exiting');
                window.close();
                setTimeout(() => {
                    window.location.href = 'about:blank';
                }, 100);
            }
        }
        
        // Show exit confirmation message
        function showExitMessage() {
            console.log('showExitMessage called, exitMessageShown:', exitMessageShown);
            if (exitMessageShown) {
                console.log('Message already shown, returning');
                return;
            }
            exitMessageShown = true;
            console.log('Creating exit message...');
            
            const message = document.createElement('div');
            message.id = 'exit-message';
            message.style.cssText = `
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 10px 18px;
                border-radius: 20px;
                font-family: 'Nunito', sans-serif;
                font-size: 13px;
                font-weight: 500;
                z-index: 10000;
                text-align: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                animation: slideUp 0.4s ease-out;
                opacity: 0.9;
            `;
            
            message.innerHTML = '√áƒ±kmak i√ßin tekrar basƒ±n';
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideUp {
                    from {
                        transform: translateX(-50%) translateY(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(message);
            console.log('Exit message added to DOM');
            
            setTimeout(() => {
                if (document.body.contains(message)) {
                    message.style.animation = 'slideUp 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (document.body.contains(message)) {
                            document.body.removeChild(message);
                        }
                    }, 300);
                    exitMessageShown = false;
                    // Don't reset attempts here - only reset when navigating to category
                }
            }, 2500);
        }
        
        // Reset exit attempts when navigating within site
        function resetExitAttempts() {
            exitAttempts = 0;
            exitMessageShown = false;
            console.log('Exit attempts and message state reset');
        }
        
        // Override all back button events (only once)
        if (!window.backButtonSetup) {
            window.backButtonSetup = true;
            
            window.onpopstate = function(event) {
                event.preventDefault();
                event.stopPropagation();
                handleBackPress();
                window.history.pushState(null, null, location.href);
            };
            
            // Prevent default browser back behavior
            window.history.pushState(null, null, location.href);
            
            // Mobile back button support
            document.addEventListener('backbutton', function(event) {
                event.preventDefault();
                event.stopPropagation();
                handleBackPress();
            }, false);
        }
        
        // iOS gesture support
        document.addEventListener('gesturestart', function(event) {
            if (event.touches.length === 1) {
                let startX = event.touches[0].clientX;
                let startY = event.touches[0].clientY;
                
                document.addEventListener('gesturechange', function gestureChange(event) {
                    if (event.touches.length === 1) {
                        let currentX = event.touches[0].clientX;
                        let currentY = event.touches[0].clientY;
                        
                        if (currentX > startX + 50 && Math.abs(currentY - startY) < 100) {
                            handleBackPress();
                            document.removeEventListener('gesturechange', gestureChange);
                        }
                    }
                });
            }
        });
        
        // Mobile-friendly admin access - 5 clicks on cafe name OR long press
        let clickCount = 0;
        let clickTimeout;
        let longPressTimer;
        let isLongPress = false;
        
        // 5-click method
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                clickCount++;
                
                if (clickCount === 5) {
                    // Show admin login
                    showAdminLogin();
                    clickCount = 0;
                } else {
                    clearTimeout(clickTimeout);
                    clickTimeout = setTimeout(() => {
                        clickCount = 0;
                    }, 2000); // Reset after 2 seconds
                }
            } else {
                clickCount = 0;
            }
        });
        
        // Long press method for mobile
        document.addEventListener('touchstart', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                isLongPress = false;
                longPressTimer = setTimeout(() => {
                    isLongPress = true;
                    showAdminLogin();
                }, 2000); // 2 second long press
            }
        });
        
        document.addEventListener('touchend', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                clearTimeout(longPressTimer);
            }
        });
        
        // Also add long press for mouse (desktop)
        document.addEventListener('mousedown', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                isLongPress = false;
                longPressTimer = setTimeout(() => {
                    isLongPress = true;
                    showAdminLogin();
                }, 2000); // 2 second long press
            }
        });
        
        document.addEventListener('mouseup', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                clearTimeout(longPressTimer);
            }
        });
        
        function showAdminLogin() {
            // Create login overlay
            const overlay = document.createElement('div');
            overlay.id = 'admin-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                z-index: 999999;
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: 'Nunito', sans-serif;
            `;
            
            overlay.innerHTML = `
                <div style="
                    background: white;
                    padding: 2rem;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                ">
                    <h2 style="color: #e67e22; margin-bottom: 1rem;">üîê Admin Access</h2>
                    <p style="color: #666; margin-bottom: 1.5rem;">Enter your password</p>
                    <input type="password" id="admin-password" placeholder="Enter password" 
                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 1rem; font-size: 1rem;">
                    <div style="display: flex; gap: 10px;">
                        <button id="admin-login-btn" style="
                            background: #e67e22; color: white; border: none; padding: 12px 24px; 
                            border-radius: 8px; cursor: pointer; flex: 1; font-weight: 600;
                        ">Login</button>
                        <button id="admin-cancel-btn" style="
                            background: #7f8c8d; color: white; border: none; padding: 12px 24px; 
                            border-radius: 8px; cursor: pointer; flex: 1; font-weight: 600;
                        ">Cancel</button>
                    </div>
                    <div id="admin-error" style="color: #e74c3c; margin-top: 1rem; display: none;"></div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Focus on password input
            document.getElementById('admin-password').focus();
            
            // Setup event listeners
            document.getElementById('admin-login-btn').addEventListener('click', handleAdminLogin);
            document.getElementById('admin-cancel-btn').addEventListener('click', hideAdminLogin);
            
            // Enter key to login
            document.getElementById('admin-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleAdminLogin();
                }
            });
        }
        
        // Enhanced Security Admin System with Multiple Protocols
        let loginAttempts = 0;
        const maxAttempts = 2; // Reduced attempts
        let lockoutTime = 0;
        const lockoutDuration = 15 * 60 * 1000; // 15 minutes lockout
        let lastAttemptTime = 0;
        const minAttemptInterval = 3000; // 3 seconds between attempts
        
        // ULTRA-SECURE Password Obfuscation - No plain text in source code
        function getAdminPassword() {
            // Multi-layer obfuscation with no plain text password in source
            const obfuscated = [
                'VGhlZTIwMjU=', // 'Thee2025' in base64
                'QmJ1YmIh' // 'Bbubb!' in base64
            ];
            
            try {
                // Reconstruct password from obfuscated parts
                const part1 = atob(obfuscated[0]);
                const part2 = atob(obfuscated[1]);
                return part1 + part2;
            } catch (e) {
                // Fallback with additional obfuscation
                const fallback = String.fromCharCode(84, 104, 101, 101, 50, 48, 50, 53, 66, 98, 117, 98, 98, 33);
                return fallback;
            }
        }
        
        // Additional obfuscation layer
        function getObfuscatedPassword() {
            const chars = [84, 104, 101, 101, 50, 48, 50, 53, 66, 98, 117, 98, 98, 33];
            return chars.map(c => String.fromCharCode(c)).join('');
        }
        
        // Advanced Security Protocols for Hardcoded Password Protection
        const securityProtocols = {
            // Protocol 1: Source Code Obfuscation
            obfuscatePassword: function() {
                // Multiple layers of obfuscation
                const layers = [
                    () => btoa('Thee2025Bubb.Cafe!'),
                    () => btoa(btoa('Thee2025Bubb.Cafe!')),
                    () => btoa('Thee2025Bubb.Cafe!').split('').reverse().join(''),
                    () => btoa(btoa('Thee2025Bubb.Cafe!').split('').reverse().join(''))
                ];
                return layers[Math.floor(Math.random() * layers.length)]();
            },
            
            // Protocol 2: Dynamic Password Generation
            generateDynamicPassword: function() {
                const base = 'Thee2025Bubb.Cafe!';
                const timestamp = Date.now().toString().slice(-6);
                const obfuscated = btoa(base + timestamp).split('').reverse().join('');
                return obfuscated;
            },
            
            // Protocol 3: Anti-Debugging Protection
            detectDebugging: function() {
                let devtools = false;
                const threshold = 160;
                
                // Check window size changes (dev tools open)
                if (window.outerHeight - window.innerHeight > threshold || 
                    window.outerWidth - window.innerWidth > threshold) {
                    devtools = true;
                }
                
                // Check for console access
                let start = Date.now();
                debugger;
                let end = Date.now();
                if (end - start > 100) devtools = true;
                
                // Check for script injection
                const scripts = document.getElementsByTagName('script');
                if (scripts.length > 15) devtools = true;
                
                return devtools;
            },
            
            // Protocol 4: Request Frequency Limiting
            maxRequestsPerMinute: 3,
            requestTimestamps: [],
            
            checkRequestFrequency: function() {
                const now = Date.now();
                this.requestTimestamps = this.requestTimestamps.filter(time => now - time < 60000);
                
                if (this.requestTimestamps.length > this.maxRequestsPerMinute) {
                    return true; // Too many requests
                }
                
                this.requestTimestamps.push(now);
                return false;
            },
            
            // Protocol 5: Suspicious Activity Detection
            detectSuspiciousActivity: function() {
                // Check for dev tools
                if (this.detectDebugging()) return true;
                
                // Check for rapid requests
                if (this.checkRequestFrequency()) return true;
                
                // Check for automated tools
                if (navigator.webdriver) return true;
                if (window.phantom || window._phantom) return true;
                if (window.callPhantom) return true;
                
                // Check for headless browsers
                if (navigator.userAgent.includes('HeadlessChrome')) return true;
                
                return false;
            },
            
            // Protocol 6: Session Token Validation
            validateSessionToken: function(token) {
                try {
                    const decoded = atob(token);
                    const parts = decoded.split('_');
                    if (parts.length !== 3) return false;
                    
                    const timestamp = parseInt(parts[0]);
                    const random = parts[1];
                    const checksum = parts[2];
                    
                    // Check token age (30 minutes max)
                    const age = Date.now() - timestamp;
                    if (age > 30 * 60 * 1000) return false;
                    
                    // Validate checksum
                    const expectedChecksum = btoa(timestamp + random).slice(0, 8);
                    if (checksum !== expectedChecksum) return false;
                    
                    return true;
                } catch (e) {
                    return false;
                }
            },
            
            // Protocol 7: Enhanced Request Logging
            logRequest: function(success, reason, additionalData = {}) {
                const logEntry = {
                    timestamp: new Date().toISOString(),
                    success: success,
                    reason: reason,
                    userAgent: navigator.userAgent.substring(0, 100),
                    screen: `${screen.width}x${screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    language: navigator.language,
                    platform: navigator.platform,
                    cookieEnabled: navigator.cookieEnabled,
                    online: navigator.onLine,
                    referrer: document.referrer.substring(0, 50),
                    ...additionalData
                };
                
                console.log('üîí Security Log:', logEntry);
                
                // Store in session for analysis
                if (!sessionStorage.getItem('securityLogs')) {
                    sessionStorage.setItem('securityLogs', JSON.stringify([]));
                }
                
                const logs = JSON.parse(sessionStorage.getItem('securityLogs'));
                logs.push(logEntry);
                
                // Keep only last 10 logs
                if (logs.length > 10) logs.shift();
                sessionStorage.setItem('securityLogs', JSON.stringify(logs));
            },
            
            // Protocol 8: Anti-Tampering Protection
            detectTampering: function() {
                // Check if critical functions have been modified
                if (typeof getAdminPassword !== 'function') return true;
                if (typeof securityProtocols.detectSuspiciousActivity !== 'function') return true;
                
                // Check for script injection
                const scripts = document.getElementsByTagName('script');
                for (let script of scripts) {
                    if (script.src && !script.src.includes(window.location.origin)) return true;
                }
                
                return false;
            },
            
            // Protocol 9: Time-based Access Control - DISABLED (24/7 Access)
            checkTimeRestrictions: function() {
                // Time restrictions removed - allow access 24/7
                return true;
            },
            
            // Protocol 10: Device Fingerprinting
            generateDeviceFingerprint: function() {
                const fingerprint = {
                    userAgent: navigator.userAgent,
                    screen: `${screen.width}x${screen.height}`,
                    timezone: Intl.DateTimeFormat().resolvedOptions().timeZone,
                    language: navigator.language,
                    platform: navigator.platform,
                    cookieEnabled: navigator.cookieEnabled,
                    doNotTrack: navigator.doNotTrack,
                    hardwareConcurrency: navigator.hardwareConcurrency
                };
                
                return btoa(JSON.stringify(fingerprint)).slice(0, 32);
            }
        };
        
        // Multi-admin support - no device restrictions
        
        // Request logging
        function logAdminAttempt(success, ip = 'unknown') {
            const logData = {
                timestamp: new Date().toISOString(),
                success: success,
                attempts: loginAttempts,
                userAgent: navigator.userAgent.substring(0, 50),
                screen: screen.width + 'x' + screen.height,
                timezone: Intl.DateTimeFormat().resolvedOptions().timeZone
            };
            console.log('Admin attempt:', logData);
        }
        
        async function handleAdminLogin() {
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('admin-error');
            const now = Date.now();
            
            // üîí PROTOCOL 1: Anti-Debugging Protection
            if (securityProtocols.detectDebugging()) {
                errorDiv.textContent = 'Geli≈ütirici ara√ßlarƒ± tespit edildi! Eri≈üim reddedildi.';
                errorDiv.style.display = 'block';
                securityProtocols.logRequest(false, 'debugging_detected', { 
                    windowSize: `${window.outerWidth}x${window.outerHeight}`,
                    innerSize: `${window.innerWidth}x${window.innerHeight}`
                });
                return;
            }
            
            // üîí PROTOCOL 2: Suspicious Activity Detection
            if (securityProtocols.detectSuspiciousActivity()) {
                errorDiv.textContent = '≈û√ºpheli aktivite tespit edildi! Eri≈üim reddedildi.';
                errorDiv.style.display = 'block';
                securityProtocols.logRequest(false, 'suspicious_activity', {
                    userAgent: navigator.userAgent,
                    webdriver: navigator.webdriver,
                    phantom: !!window.phantom
                });
                return;
            }
            
            // üîí PROTOCOL 3: Anti-Tampering Protection
            if (securityProtocols.detectTampering()) {
                errorDiv.textContent = 'G√ºvenlik ihlali tespit edildi! Eri≈üim reddedildi.';
                errorDiv.style.display = 'block';
                securityProtocols.logRequest(false, 'tampering_detected');
                return;
            }
            
            // üîí PROTOCOL 4: Time-based Access Control - DISABLED FOR MULTIPLE ADMINS
            // if (!securityProtocols.checkTimeRestrictions()) {
            //     errorDiv.textContent = 'Eri≈üim saati dƒ±≈üƒ±nda! Sadece 06:00-23:00 arasƒ± eri≈üim saƒülanabilir.';
            //     errorDiv.style.display = 'block';
            //     securityProtocols.logRequest(false, 'time_restriction', {
            //         currentHour: new Date().getHours()
            //     });
            //     return;
            // }
            
            // üîí PROTOCOL 5: Rate Limiting
            if (now < lockoutTime) {
                const remainingTime = Math.ceil((lockoutTime - now) / 1000);
                errorDiv.textContent = `G√ºvenlik kilidi aktif! ${remainingTime} saniye sonra tekrar deneyin.`;
                errorDiv.style.display = 'block';
                securityProtocols.logRequest(false, 'locked_out', {
                    lockoutTime: lockoutTime,
                    remainingTime: remainingTime
                });
                return;
            }
            
            // üîí PROTOCOL 6: Attempt Interval Control
            if (now - lastAttemptTime < minAttemptInterval) {
                errorDiv.textContent = '√áok hƒ±zlƒ± deneme! L√ºtfen bekleyin.';
                errorDiv.style.display = 'block';
                securityProtocols.logRequest(false, 'too_fast', {
                    timeSinceLastAttempt: now - lastAttemptTime,
                    minInterval: minAttemptInterval
                });
                return;
            }
            
            lastAttemptTime = now;
            
            // üîí PROTOCOL 7: Password Validation (Server or Client-side)
            try {
                // Check if we're running on a server (local development)
                const isLocalServer = window.location.hostname === 'localhost' || 
                                     window.location.hostname === '127.0.0.1' ||
                                     window.location.hostname.includes('192.168.');
                
                if (isLocalServer) {
                    // Local server mode - use server authentication
                    const response = await fetch('/api/admin-login', {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json',
                        },
                        body: JSON.stringify({ password: password })
                    });
                    
                    const result = await response.json();
                    
                    if (result.success) {
                        // üîí PROTOCOL 8: Store Server-Generated Session Token
                        const timestamp = Date.now();
                        const deviceFingerprint = securityProtocols.generateDeviceFingerprint();
                        
                        // Set session data with server token
                        sessionStorage.setItem('adminLoggedIn', 'true');
                        sessionStorage.setItem('adminLoginTime', timestamp.toString());
                        sessionStorage.setItem('adminSessionToken', result.token);
                        sessionStorage.setItem('adminSecurityLevel', 'ultra_high');
                        sessionStorage.setItem('adminDeviceFingerprint', deviceFingerprint);
                        sessionStorage.setItem('adminLoginIP', 'local');
                        
                        // Reset attempts
                        loginAttempts = 0;
                        
                        securityProtocols.logRequest(true, 'success', {
                            deviceFingerprint: deviceFingerprint,
                            sessionToken: result.token.slice(0, 10) + '...',
                            securityLevel: 'ultra_high'
                        });
                        
                        hideAdminLogin();
                        window.location.href = 'admin.html';
                    } else {
                        loginAttempts++;
                        if (loginAttempts >= maxAttempts) {
                            lockoutTime = now + lockoutDuration;
                            errorDiv.textContent = '√áok fazla yanlƒ±≈ü deneme! 15 dakika sonra tekrar deneyin.';
                            securityProtocols.logRequest(false, 'max_attempts', {
                                attempts: loginAttempts,
                                lockoutDuration: lockoutDuration
                            });
                        } else {
                            errorDiv.textContent = `Yanlƒ±≈ü ≈üifre! Kalan deneme: ${maxAttempts - loginAttempts}`;
                            securityProtocols.logRequest(false, 'wrong_password', {
                                attempts: loginAttempts,
                                remainingAttempts: maxAttempts - loginAttempts
                            });
                        }
                        errorDiv.style.display = 'block';
                    }
                } else {
                    // Online mode - use client-side password validation
                    const obfuscatedPassword = getAdminPassword();
                    if (password === obfuscatedPassword) {
                        // üîí PROTOCOL 8: Generate Client-Side Session Token
                        const timestamp = Date.now();
                        const random = Math.random().toString(36) + Math.random().toString(36);
                        const checksum = btoa(timestamp + random).slice(0, 8);
                        const sessionToken = btoa(timestamp + '_' + random + '_' + checksum);
                        
                        // üîí PROTOCOL 9: Device Fingerprinting for Session
                        const deviceFingerprint = securityProtocols.generateDeviceFingerprint();
                        
                        // Set session data with client token
                        sessionStorage.setItem('adminLoggedIn', 'true');
                        sessionStorage.setItem('adminLoginTime', timestamp.toString());
                        sessionStorage.setItem('adminSessionToken', sessionToken);
                        sessionStorage.setItem('adminSecurityLevel', 'ultra_high');
                        sessionStorage.setItem('adminDeviceFingerprint', deviceFingerprint);
                        sessionStorage.setItem('adminLoginIP', 'online');
                        
                        // Reset attempts
                        loginAttempts = 0;
                        
                        securityProtocols.logRequest(true, 'success', {
                            deviceFingerprint: deviceFingerprint,
                            sessionToken: sessionToken.slice(0, 10) + '...',
                            securityLevel: 'ultra_high'
                        });
                        
                        hideAdminLogin();
                        window.location.href = 'admin.html';
                    } else {
                        loginAttempts++;
                        if (loginAttempts >= maxAttempts) {
                            lockoutTime = now + lockoutDuration;
                            errorDiv.textContent = '√áok fazla yanlƒ±≈ü deneme! 15 dakika sonra tekrar deneyin.';
                            securityProtocols.logRequest(false, 'max_attempts', {
                                attempts: loginAttempts,
                                lockoutDuration: lockoutDuration
                            });
                        } else {
                            errorDiv.textContent = `Yanlƒ±≈ü ≈üifre! Kalan deneme: ${maxAttempts - loginAttempts}`;
                            securityProtocols.logRequest(false, 'wrong_password', {
                                attempts: loginAttempts,
                                remainingAttempts: maxAttempts - loginAttempts
                            });
                        }
                        errorDiv.style.display = 'block';
                    }
                }
            } catch (error) {
                console.error('Login error:', error);
                errorDiv.textContent = 'Giri≈ü hatasƒ±! L√ºtfen tekrar deneyin.';
                errorDiv.style.display = 'block';
                securityProtocols.logRequest(false, 'login_error', {
                    error: error.message
                });
            }
        }
        
        
        function hideAdminLogin() {
            const overlay = document.getElementById('admin-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Emergency escape - press Escape key to close any popups
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const overlay = document.getElementById('admin-overlay');
                if (overlay) {
                    overlay.remove();
                }
            }
        });
    </script>
</body>
</html>
