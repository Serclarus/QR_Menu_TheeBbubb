<!DOCTYPE html>
    <html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Kafe Menüsü - QR Kod Tarayın</title>
    <link rel="stylesheet" href="styles.css?v=60">
    <link href="https://fonts.googleapis.com/css2?family=Nunito:wght@400;600;700;800&family=Open+Sans:wght@300;400;600&display=swap" rel="stylesheet">
</head>
<body>
    <div class="container">
        <!-- Header with Cafe Image -->
        <header class="header">
            <div class="cafe-image">
                <img src="https://images.unsplash.com/photo-1554118811-1e0d58224f24?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1000&q=80" alt="Cafe Interior" />
                <div class="cafe-overlay">
                    <h1 class="cafe-name">THEE BBUBB CAFE</h1>
                    <p class="cafe-description">Lezzetli kahve ve taze yemekler için bizi tercih edin</p>
                </div>
            </div>
        </header>

        <!-- Navigation -->
        <nav class="main-nav">
            <h2>Menümüz</h2>
            <div class="category-grid">
                <div class="category-card" data-category="hot-drinks">
                    <div class="category-icon">
                        <img src="hotdrinks_icon.png" alt="Sıcak İçecekler" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Sıcak İçecekler</h3>
                </div>
                <div class="category-card" data-category="cold-drinks">
                    <div class="category-icon">
                        <img src="colddrinks_icon.png" alt="Soğuk İçecekler" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Soğuk İçecekler</h3>
                </div>
                <div class="category-card" data-category="meals">
                    <div class="category-icon">
                        <img src="foods_icon.png" alt="Yemekler" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Yemekler</h3>
                </div>
                <div class="category-card" data-category="desserts">
                    <div class="category-icon">
                        <img src="desserts_icon.png" alt="Tatlılar" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Tatlılar</h3>
                </div>
                <div class="category-card" data-category="snacks">
                    <div class="category-icon">
                        <img src="snacks_icon.png" alt="Atıştırmalıklar" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Atıştırmalıklar</h3>
                </div>
                <div class="category-card" data-category="nargile">
                    <div class="category-icon">
                        <img src="hookah-icon.png" alt="Nargile" style="width: 40px; height: 40px;">
                    </div>
                    <h3>Nargile</h3>
                </div>
            </div>
        </nav>
        
        <!-- Instagram Button -->
        <div class="instagram-section">
            <a href="https://www.instagram.com/theebbubb/" id="instagram-link" class="instagram-btn">
                <img src="instagram_icon.png" alt="Instagram" class="instagram-logo">
            </a>
        </div>

        <!-- Category Content -->
        <main class="category-content" id="category-content">
            <!-- Content will be dynamically loaded here -->
        </main>

        <!-- Back Button -->
        <button class="back-btn" id="back-btn" style="display: none;">
            ← Menüye Dön
        </button>
        
        <!-- Secure Admin Access - Hidden and protected -->
    </div>

    <script src="script.js"></script>
    <script>
        // Instagram button handler - try app first, then website in new tab
        document.addEventListener('DOMContentLoaded', function() {
            const instagramLink = document.getElementById('instagram-link');
            if (instagramLink) {
                instagramLink.addEventListener('click', function(e) {
                    e.preventDefault();
                    
                    // Try to open Instagram app first
                    const appUrl = 'instagram://user?username=theebbubb';
                    const webUrl = 'https://www.instagram.com/theebbubb/';
                    
                    // Create a hidden iframe to test if the app opens
                    const iframe = document.createElement('iframe');
                    iframe.style.display = 'none';
                    iframe.src = appUrl;
                    document.body.appendChild(iframe);
                    
                    // Set a timeout to check if the app opened
                    setTimeout(() => {
                        document.body.removeChild(iframe);
                        // If we're still here, the app didn't open, so open the website in new tab
                        window.open(webUrl, '_blank');
                    }, 1000);
                });
            }
        });

        // Clean Back Button System - From Scratch
        let exitAttempts = 0;
        let exitMessageShown = false;
        let isProcessingBack = false;
        let lastBackPress = 0;
        let isOnMainPageState = true; // Track current page state
        
        // Check if we're on main page or in a category
        function isOnMainPage() {
            const categoryContent = document.getElementById('category-content');
            const mainNav = document.querySelector('.main-nav');
            
            // Simple check: if category content is not visible, we're on main page
            const isCategoryVisible = categoryContent && categoryContent.style.display === 'block';
            const isMain = !isCategoryVisible;
            
            console.log('isOnMainPage check:', { 
                categoryContent, 
                categoryDisplay: categoryContent?.style.display, 
                isCategoryVisible,
                isMain 
            });
            return isMain;
        }
        
        // Handle back button press
        function handleBackPress() {
            const now = Date.now();
            
            // Prevent multiple rapid triggers
            if (isProcessingBack || (now - lastBackPress) < 500) {
                console.log('Back button ignored - too soon or already processing');
                return;
            }
            
            isProcessingBack = true;
            lastBackPress = now;
            
            console.log('Back button pressed, isOnMainPageState:', isOnMainPageState);
            
            // Check current page state dynamically
            const categoryContent = document.getElementById('category-content');
            const isCurrentlyInCategory = categoryContent && categoryContent.style.display === 'block';
            
            if (isCurrentlyInCategory) {
                // In category - go to main page
                console.log('In category - going to main page');
                goToMainPage();
            } else {
                // On main page - show exit confirmation
                console.log('On main page - showing exit confirmation');
                handleExitAttempt();
            }
            
            // Reset processing flag after a delay
            setTimeout(() => {
                isProcessingBack = false;
            }, 1000);
        }
        
        // Go to main page (direct navigation)
        function goToMainPage() {
            console.log('goToMainPage called');
            const mainNav = document.querySelector('.main-nav');
            const backBtn = document.getElementById('back-btn');
            const categoryContent = document.getElementById('category-content');
            const instagramSection = document.querySelector('.instagram-section');
            
            console.log('Elements found:', { mainNav, backBtn, categoryContent, instagramSection });
            
            // Show main navigation
            if (mainNav) {
                mainNav.style.display = 'block';
                console.log('Main nav shown');
            }
            
            // Hide back button
            if (backBtn) {
                backBtn.style.display = 'none';
                console.log('Back button hidden');
            }
            
            // Hide category content
            if (categoryContent) {
                categoryContent.style.display = 'none';
                categoryContent.innerHTML = '';
                console.log('Category content hidden');
            }
            
            // Show Instagram button
            if (instagramSection) {
                instagramSection.classList.remove('hidden');
                console.log('Instagram section shown');
            }
            
            // Scroll to top
            window.scrollTo(0, 0);
            
            // Reset exit attempts when going to main page
            resetExitAttempts();
            
            // Update state to main page
            isOnMainPageState = true;
            console.log('goToMainPage completed, isOnMainPageState set to true');
        }
        
        // Handle exit attempts
        function handleExitAttempt() {
            console.log('Exit attempt #' + (exitAttempts + 1));
            exitAttempts++;
            
            if (exitAttempts === 1) {
                // First attempt - show message
                console.log('Showing exit message');
                showExitMessage();
            } else if (exitAttempts >= 2) {
                // Second attempt - actually exit
                console.log('Second exit attempt - exiting');
                window.close();
                setTimeout(() => {
                    window.location.href = 'about:blank';
                }, 100);
            }
        }
        
        // Show exit confirmation message
        function showExitMessage() {
            console.log('showExitMessage called, exitMessageShown:', exitMessageShown);
            if (exitMessageShown) {
                console.log('Message already shown, returning');
                return;
            }
            exitMessageShown = true;
            console.log('Creating exit message...');
            
            const message = document.createElement('div');
            message.id = 'exit-message';
            message.style.cssText = `
                position: fixed;
                bottom: 30px;
                left: 50%;
                transform: translateX(-50%);
                background: rgba(0, 0, 0, 0.7);
                color: white;
                padding: 10px 18px;
                border-radius: 20px;
                font-family: 'Nunito', sans-serif;
                font-size: 13px;
                font-weight: 500;
                z-index: 10000;
                text-align: center;
                box-shadow: 0 2px 8px rgba(0, 0, 0, 0.2);
                animation: slideUp 0.4s ease-out;
                opacity: 0.9;
            `;
            
            message.innerHTML = 'Çıkmak için tekrar basın';
            
            const style = document.createElement('style');
            style.textContent = `
                @keyframes slideUp {
                    from {
                        transform: translateX(-50%) translateY(100%);
                        opacity: 0;
                    }
                    to {
                        transform: translateX(-50%) translateY(0);
                        opacity: 1;
                    }
                }
            `;
            document.head.appendChild(style);
            
            document.body.appendChild(message);
            console.log('Exit message added to DOM');
            
            setTimeout(() => {
                if (document.body.contains(message)) {
                    message.style.animation = 'slideUp 0.3s ease-out reverse';
                    setTimeout(() => {
                        if (document.body.contains(message)) {
                            document.body.removeChild(message);
                        }
                    }, 300);
                    exitMessageShown = false;
                    // Don't reset attempts here - only reset when navigating to category
                }
            }, 2500);
        }
        
        // Reset exit attempts when navigating within site
        function resetExitAttempts() {
            exitAttempts = 0;
            exitMessageShown = false;
            console.log('Exit attempts and message state reset');
        }
        
        // Override all back button events (only once)
        if (!window.backButtonSetup) {
            window.backButtonSetup = true;
            
            window.onpopstate = function(event) {
                event.preventDefault();
                event.stopPropagation();
                handleBackPress();
                window.history.pushState(null, null, location.href);
            };
            
            // Prevent default browser back behavior
            window.history.pushState(null, null, location.href);
            
            // Mobile back button support
            document.addEventListener('backbutton', function(event) {
                event.preventDefault();
                event.stopPropagation();
                handleBackPress();
            }, false);
        }
        
        // iOS gesture support
        document.addEventListener('gesturestart', function(event) {
            if (event.touches.length === 1) {
                let startX = event.touches[0].clientX;
                let startY = event.touches[0].clientY;
                
                document.addEventListener('gesturechange', function gestureChange(event) {
                    if (event.touches.length === 1) {
                        let currentX = event.touches[0].clientX;
                        let currentY = event.touches[0].clientY;
                        
                        if (currentX > startX + 50 && Math.abs(currentY - startY) < 100) {
                            handleBackPress();
                            document.removeEventListener('gesturechange', gestureChange);
                        }
                    }
                });
            }
        });
        
        // Mobile-friendly admin access - 5 clicks on cafe name OR long press
        let clickCount = 0;
        let clickTimeout;
        let longPressTimer;
        let isLongPress = false;
        
        // 5-click method
        document.addEventListener('click', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                clickCount++;
                
                if (clickCount === 5) {
                    // Show admin login
                    showAdminLogin();
                    clickCount = 0;
                } else {
                    clearTimeout(clickTimeout);
                    clickTimeout = setTimeout(() => {
                        clickCount = 0;
                    }, 2000); // Reset after 2 seconds
                }
            } else {
                clickCount = 0;
            }
        });
        
        // Long press method for mobile
        document.addEventListener('touchstart', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                isLongPress = false;
                longPressTimer = setTimeout(() => {
                    isLongPress = true;
                    showAdminLogin();
                }, 2000); // 2 second long press
            }
        });
        
        document.addEventListener('touchend', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                clearTimeout(longPressTimer);
            }
        });
        
        // Also add long press for mouse (desktop)
        document.addEventListener('mousedown', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                isLongPress = false;
                longPressTimer = setTimeout(() => {
                    isLongPress = true;
                    showAdminLogin();
                }, 2000); // 2 second long press
            }
        });
        
        document.addEventListener('mouseup', function(e) {
            if (e.target.classList.contains('cafe-name')) {
                clearTimeout(longPressTimer);
            }
        });
        
        function showAdminLogin() {
            // Create login overlay
            const overlay = document.createElement('div');
            overlay.id = 'admin-overlay';
            overlay.style.cssText = `
                position: fixed;
                top: 0;
                left: 0;
                width: 100%;
                height: 100%;
                background: rgba(0,0,0,0.9);
                z-index: 999999;
                display: flex;
                justify-content: center;
                align-items: center;
                font-family: 'Nunito', sans-serif;
            `;
            
            overlay.innerHTML = `
                <div style="
                    background: white;
                    padding: 2rem;
                    border-radius: 15px;
                    box-shadow: 0 10px 30px rgba(0,0,0,0.3);
                    max-width: 400px;
                    width: 90%;
                    text-align: center;
                ">
                    <h2 style="color: #e67e22; margin-bottom: 1rem;">🔐 Admin Access</h2>
                    <p style="color: #666; margin-bottom: 1.5rem;">Enter your password</p>
                    <input type="password" id="admin-password" placeholder="Enter password" 
                           style="width: 100%; padding: 12px; border: 2px solid #ddd; border-radius: 8px; margin-bottom: 1rem; font-size: 1rem;">
                    <div style="display: flex; gap: 10px;">
                        <button id="admin-login-btn" style="
                            background: #e67e22; color: white; border: none; padding: 12px 24px; 
                            border-radius: 8px; cursor: pointer; flex: 1; font-weight: 600;
                        ">Login</button>
                        <button id="admin-cancel-btn" style="
                            background: #7f8c8d; color: white; border: none; padding: 12px 24px; 
                            border-radius: 8px; cursor: pointer; flex: 1; font-weight: 600;
                        ">Cancel</button>
                    </div>
                    <div id="admin-error" style="color: #e74c3c; margin-top: 1rem; display: none;"></div>
                </div>
            `;
            
            document.body.appendChild(overlay);
            
            // Focus on password input
            document.getElementById('admin-password').focus();
            
            // Setup event listeners
            document.getElementById('admin-login-btn').addEventListener('click', handleAdminLogin);
            document.getElementById('admin-cancel-btn').addEventListener('click', hideAdminLogin);
            
            // Enter key to login
            document.getElementById('admin-password').addEventListener('keypress', (e) => {
                if (e.key === 'Enter') {
                    handleAdminLogin();
                }
            });
        }
        
        // ULTRA SECURE Admin System
        let loginAttempts = 0;
        const maxAttempts = 2; // Reduced attempts
        let lockoutTime = 0;
        const lockoutDuration = 15 * 60 * 1000; // 15 minutes lockout
        let sessionStartTime = 0;
        
        // Multiple password layers with obfuscation
        const passwordLayers = [
            'SecureAdmin2024!',
            'TheeBbubb2024!',
            'CafeAdmin2024!'
        ];
        
        function handleAdminLogin() {
            const password = document.getElementById('admin-password').value;
            const errorDiv = document.getElementById('admin-error');
            
            // Check if locked out
            if (Date.now() < lockoutTime) {
                const remainingTime = Math.ceil((lockoutTime - Date.now()) / 1000);
                errorDiv.textContent = `Güvenlik kilidi aktif! ${remainingTime} saniye sonra tekrar deneyin.`;
                errorDiv.style.display = 'block';
                return;
            }
            
            // Multi-layer password validation
            let isValidPassword = false;
            for (let i = 0; i < passwordLayers.length; i++) {
                const layer = passwordLayers[i];
                const hashedInput = btoa(password + 'ULTRA_SECURE_' + i + '_SALT');
                const expectedHash = btoa(layer + 'ULTRA_SECURE_' + i + '_SALT');
                if (hashedInput === expectedHash) {
                    isValidPassword = true;
                    break;
                }
            }
            
            if (isValidPassword) {
                // Generate ultra-secure token with multiple validations
                const token = generateUltraSecureToken();
                const sessionId = generateSessionId();
                
                sessionStorage.setItem('adminAccess', token);
                sessionStorage.setItem('adminLoginTime', Date.now().toString());
                sessionStorage.setItem('adminSessionId', sessionId);
                sessionStorage.setItem('adminFingerprint', generateDeviceFingerprint());
                
                // Reset attempts and set session start
                loginAttempts = 0;
                sessionStartTime = Date.now();
                
                hideAdminLogin();
                window.location.href = 'admin.html';
            } else {
                loginAttempts++;
                if (loginAttempts >= maxAttempts) {
                    lockoutTime = Date.now() + lockoutDuration;
                    errorDiv.textContent = 'Güvenlik ihlali tespit edildi! 15 dakika sonra tekrar deneyin.';
                } else {
                    errorDiv.textContent = `Yanlış şifre! Kalan deneme: ${maxAttempts - loginAttempts}`;
                }
                errorDiv.style.display = 'block';
            }
        }
        
        function generateUltraSecureToken() {
            const timestamp = Date.now();
            const random1 = Math.random().toString(36).substring(2, 15);
            const random2 = Math.random().toString(36).substring(2, 15);
            const userAgent = navigator.userAgent.substring(0, 30);
            const screenRes = screen.width + 'x' + screen.height;
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const language = navigator.language;
            const platform = navigator.platform;
            const cookieEnabled = navigator.cookieEnabled;
            const doNotTrack = navigator.doNotTrack;
            
            // Create ultra-complex token with multiple security layers
            const tokenData = timestamp + random1 + userAgent + screenRes + timezone + language + platform + cookieEnabled + doNotTrack + random2 + 'ULTRA_SECURE_ADMIN_2024';
            const token = btoa(btoa(tokenData)); // Double encoding
            
            return token;
        }
        
        function generateSessionId() {
            const timestamp = Date.now();
            const random = Math.random().toString(36).substring(2, 15);
            const userAgent = navigator.userAgent.substring(0, 20);
            return btoa(timestamp + random + userAgent + 'SESSION_ID');
        }
        
        function generateDeviceFingerprint() {
            const screenRes = screen.width + 'x' + screen.height;
            const timezone = Intl.DateTimeFormat().resolvedOptions().timeZone;
            const language = navigator.language;
            const platform = navigator.platform;
            const cookieEnabled = navigator.cookieEnabled;
            const doNotTrack = navigator.doNotTrack;
            const colorDepth = screen.colorDepth;
            const pixelRatio = window.devicePixelRatio;
            
            return btoa(screenRes + timezone + language + platform + cookieEnabled + doNotTrack + colorDepth + pixelRatio + 'FINGERPRINT');
        }
        
        function hideAdminLogin() {
            const overlay = document.getElementById('admin-overlay');
            if (overlay) {
                overlay.remove();
            }
        }
        
        // Emergency escape - press Escape key to close any popups
        document.addEventListener('keydown', function(e) {
            if (e.key === 'Escape') {
                const overlay = document.getElementById('admin-overlay');
                if (overlay) {
                    overlay.remove();
                }
            }
        });
    </script>
</body>
</html>
